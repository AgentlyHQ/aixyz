---
title: "aixyz/server"
description: "The core server class that wraps Express 5 with x402 payment support"
---

`AixyzServer` extends `x402ResourceServer` from `@x402/core/server`, which wraps Express 5. It provides built-in x402 payment verification for agent and tool endpoints.

```typescript
import { AixyzServer } from "aixyz/server";
```

## Constructor

```typescript
new AixyzServer(
  facilitator?: FacilitatorClient,
  config?: AixyzConfig,
  express?: Express
)
```

| Parameter     | Type                | Default                       | Description                  |
| ------------- | ------------------- | ----------------------------- | ---------------------------- |
| `facilitator` | `FacilitatorClient` | Default x402 facilitator      | Payment verification service |
| `config`      | `AixyzConfig`       | Loaded from `aixyz.config.ts` | Agent configuration          |
| `express`     | `Express`           | New Express 5 app             | Express instance to use      |

After constructing, call `await server.initialize()` before registering any routes.

## Properties

| Property  | Type          | Description                    |
| --------- | ------------- | ------------------------------ |
| `config`  | `AixyzConfig` | The parsed agent configuration |
| `express` | `Express`     | The underlying Express 5 app   |

## Methods

### `withX402Exact(route, accepts)`

Registers x402 payment middleware on a route:

```typescript
server.withX402Exact("POST /agent", {
  scheme: "exact",
  price: "$0.005",
});
```

| Parameter | Type                                  | Description           |
| --------- | ------------------------------------- | --------------------- |
| `route`   | `` `${"GET" \| "POST"} /${string}` `` | Route pattern         |
| `accepts` | `AcceptsX402`                         | Payment configuration |

The `payTo` and `network` fields default to the values from your `aixyz.config.ts` if not specified in the `accepts` object.

### `withPaymentRequirements(accepts)`

Builds payment requirements for a given accepts configuration. Used internally by the MCP adapter.

```typescript
const requirements = await server.withPaymentRequirements({
  scheme: "exact",
  price: "$0.001",
});
```

## Example

```typescript
import { AixyzServer } from "aixyz/server";
import { useA2A } from "aixyz/server/adapters/a2a";
import { AixyzMCP } from "aixyz/server/adapters/mcp";
import * as agent from "./agent";

const server = new AixyzServer();
await server.initialize();
server.unstable_withIndexPage();

useA2A(server, agent);

export default server;
```
